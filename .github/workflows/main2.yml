name: ðŸ” APK Finder Only

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # â—€ï¸ Ø¨Ø­Ø« ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª

permissions:
  contents: read

jobs:
  find-existing-apk:
    name: ðŸ”Ž Find Existing APK
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # â—€ï¸ ØªØ¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
        
    - name: ðŸ” Search for existing APK files
      id: find_apk
      run: |
        echo "ðŸ” Searching for existing APK files in repository..."
        
        # Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
        echo "ðŸ“Š Repository structure:"
        find . -type f -name "*.apk" | head -20
        
        # Ø§Ù„Ø¨Ø­Ø« ÙÙŠ commits Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø£ÙŠØ¶Ø§Ù‹
        APK_IN_HISTORY=$(git log --all --oneline --name-only --grep=".apk" | grep ".apk" | head -5)
        
        if [ -n "$APK_IN_HISTORY" ]; then
          echo "ðŸ“œ Found APK in git history:"
          echo "$APK_IN_HISTORY"
        fi
        
        # Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­Ø§Ù„ÙŠ
        CURRENT_APK=$(find . -type f -name "*.apk" 2>/dev/null | head -1)
        
        if [ -z "$CURRENT_APK" ]; then
          echo "âŒ No APK files found in current repository"
          echo "apk_found=false" >> $GITHUB_OUTPUT
        else
          echo "âœ… Found existing APK: $CURRENT_APK"
          echo "apk_found=true" >> $GITHUB_OUTPUT
          echo "apk_path=$CURRENT_APK" >> $GITHUB_OUTPUT
          
          # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
          APK_SIZE=$(stat -c%s "$CURRENT_APK" 2>/dev/null || echo "0")
          APK_SIZE_MB=$(echo "scale=2; $APK_SIZE / 1048576" | bc)
          APK_DATE=$(stat -c%y "$CURRENT_APK" 2>/dev/null || echo "unknown")
          
          echo "ðŸ“¦ APK Size: $APK_SIZE_MB MB"
          echo "ðŸ“… Last modified: $APK_DATE"
        fi
        
    - name: ðŸ“Š Create APK Report
      if: steps.find_apk.outputs.apk_found == 'true'
      run: |
        echo "ðŸ“„ Creating APK download report..."
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ØªÙ‚Ø±ÙŠØ±
        cat > APK_REPORT.md << EOF
        # ðŸ“± YST Downloader APK Report
        
        ## ðŸ” Scan Results
        - **Scan Date:** $(date)
        - **APK Found:** âœ… YES
        - **APK Path:** ${{ steps.find_apk.outputs.apk_path }}
        
        ## ðŸ“¦ File Information
        - **Location:** \`${{ steps.find_apk.outputs.apk_path }}\`
        - **Repository:** ${{ github.repository }}
        - **Branch:** ${{ github.ref }}
        
        ## â¬‡ï¸ Download Instructions
        
        ### Option 1: Direct Download
        [Download APK](${{ github.server_url }}/${{ github.repository }}/raw/${{ github.ref_name }}/${{ steps.find_apk.outputs.apk_path }})
        
        ### Option 2: Clone Repository
        \`\`\`bash
        git clone https://github.com/${{ github.repository }}.git
        cd $(basename ${{ github.repository }})
        # APK will be in: ${{ steps.find_apk.outputs.apk_path }}
        \`\`\`
        
        ### Option 3: Download ZIP
        1. Go to repository main page
        2. Click "Code" â†’ "Download ZIP"
        3. Extract and find APK in: \`${{ steps.find_apk.outputs.apk_path }}\`
        
        ## ðŸ” How to find it manually
        1. Browse the repository
        2. Navigate to: \`${{ steps.find_apk.outputs.apk_path }}\`
        3. Click "Download" button
        
        ---
        *This report was automatically generated by APK Finder*
        EOF
        
        echo "âœ… APK report created"
        
    - name: ðŸš« No APK Found Message
      if: steps.find_apk.outputs.apk_found == 'false'
      run: |
        echo "ðŸ“ Creating 'No APK Found' message..."
        
        cat > NO_APK.md << EOF
        # âŒ APK Not Found
        
        ## ðŸ” Scan Results
        - **Scan Date:** $(date)
        - **APK Found:** âŒ NO
        - **Status:** No APK files found in repository
        
        ## ðŸ“Š Repository Analysis
        - **Total Files:** $(find . -type f | wc -l)
        - **Repository Size:** $(du -sh . | cut -f1)
        - **Last Commit:** $(git log -1 --format="%cd" --date=short)
        
        ## ðŸ¤” Possible Reasons
        1. APK was never built
        2. APK was deleted
        3. APK is in a different branch
        4. APK is in git history only
        5. APK has different extension (.apk, .APK, etc.)
        
        ## ðŸ’¡ Solutions
        1. **Run Build Workflow** to create new APK
        2. **Check other branches** for existing APK
        3. **Look in git history** for deleted APK
        4. **Search manually** in repository
        
        ## ðŸ” Search Commands
        \`\`\`bash
        # Search for APK in current directory
        find . -type f -name "*.apk"
        
        # Search case-insensitive
        find . -type f -iname "*.apk"
        
        # Search in git history
        git log --all --oneline --name-only | grep -i "apk"
        \`\`\`
        
        ---
        *This report was automatically generated by APK Finder*
        EOF
        
    - name: ðŸ“¤ Upload Reports
      uses: actions/upload-artifact@v4
      with:
        name: apk-finder-reports
        path: |
          APK_REPORT.md
          NO_APK.md
        retention-days: 7
        
    - name: ðŸ“¢ Display Download Link
      if: steps.find_apk.outputs.apk_found == 'true'
      run: |
        echo " "
        echo "=========================================="
        echo "ðŸ“± YST DOWNLOADER APK FOUND! ðŸŽ‰"
        echo "=========================================="
        echo " "
        echo "âœ… APK Location: ${{ steps.find_apk.outputs.apk_path }}"
        echo " "
        echo "â¬‡ï¸ DIRECT DOWNLOAD LINK:"
        echo "https://github.com/${{ github.repository }}/raw/${{ github.ref_name }}/${{ steps.find_apk.outputs.apk_path }}"
        echo " "
        echo "ðŸ“‹ Copy this command to download:"
        echo "curl -L -o YST-Downloader.apk \\"
        echo "  https://github.com/${{ github.repository }}/raw/${{ github.ref_name }}/${{ steps.find_apk.outputs.apk_path }}"
        echo " "
        echo "ðŸ“ Report saved in Artifacts: 'apk-finder-reports'"
        echo "=========================================="
        
    - name: ðŸ“¢ No APK Found Notification
      if: steps.find_apk.outputs.apk_found == 'false'
      run: |
        echo " "
        echo "=========================================="
        echo "âŒ NO APK FOUND IN REPOSITORY"
        echo "=========================================="
        echo " "
        echo "ðŸ” Searched entire repository but no .apk files found"
        echo " "
        echo "ðŸ’¡ Possible solutions:"
        echo "1. Build an APK first using build workflow"
        echo "2. Check if APK exists in another branch"
        echo "3. Upload APK manually to repository"
        echo " "
        echo "ðŸ“ 'No APK' report saved in Artifacts"
        echo "=========================================="
